<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pirandello ‚Äî Uno, nessuno e centomila</title>
  <style>
    :root{
      --bg:#0f141a;
      --panel:rgba(255,255,255,.08);
      --panel2:rgba(0,0,0,.14);
      --stroke:rgba(255,255,255,.16);
      --stroke2:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.90);
      --muted:rgba(255,255,255,.70);
      --muted2:rgba(255,255,255,.55);
      --accent:#f0c36a;
      --paper:#f4efe6;
      --ink:#1a1a1a;
      --shadow: 0 20px 55px rgba(0,0,0,.45);
      --radius: 18px;
      --radius2: 14px;
      --font: ui-serif, Georgia, "Times New Roman", Times, serif;
      --ui: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

      --paperLine: rgba(0,0,0,.06);
      --paperEdge: rgba(0,0,0,.10);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:
        radial-gradient(1200px 800px at 20% 15%, rgba(255,255,255,.12), transparent 55%),
        radial-gradient(900px 600px at 80% 30%, rgba(240,195,106,.18), transparent 55%),
        radial-gradient(900px 600px at 50% 90%, rgba(130,200,255,.12), transparent 60%),
        var(--bg);
      color:var(--text);
      font-family:var(--ui);
      overflow-x:hidden;
    }

    header{
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(12px);
      background: linear-gradient(to bottom, rgba(15,20,26,.82), rgba(15,20,26,.55));
      border-bottom:1px solid var(--stroke2);
    }
    .topbar{
      max-width:1200px;
      margin:0 auto;
      display:flex;
      align-items:center;
      gap:14px;
      padding:12px 14px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      min-width:240px;
    }
    .logo{
      width:36px; height:36px; border-radius:12px;
      background: linear-gradient(135deg, rgba(240,195,106,.95), rgba(255,255,255,.28));
      box-shadow: 0 12px 26px rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.25);
    }
    .brand h2{
      margin:0; font-size:14px; letter-spacing:.3px; font-weight:800;
    }
    .brand small{ display:block; margin-top:2px; color:var(--muted2); font-weight:600; }

    .controls{
      margin-left:auto;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.08);
      color:var(--text);
      padding:8px 10px;
      border-radius:12px;
      font-weight:700;
      cursor:pointer;
      transition:.2s;
      font-size:13px;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.12); }
    .btn:active{ transform: translateY(0px); }

    .seg{
      display:flex;
      border:1px solid var(--stroke);
      border-radius:14px;
      overflow:hidden;
      background: rgba(0,0,0,.18);
    }
    .seg button{
      padding:8px 10px;
      border:0;
      background:transparent;
      color:var(--muted);
      font-weight:800;
      cursor:pointer;
      font-size:13px;
    }
    .seg button.active{
      background: rgba(240,195,106,.18);
      color:var(--text);
    }

    .slider{
      display:flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border:1px solid var(--stroke);
      border-radius:14px;
      background: rgba(255,255,255,.06);
      font-weight:800;
      color:var(--muted);
      font-size:12px;
    }
    input[type="range"]{ width:120px; }

    .wrap{
      max-width:1200px;
      margin: 16px auto 60px;
      padding:0 14px;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:16px;
    }

    @media (max-width: 980px){
      .wrap{ grid-template-columns: 1fr; }
      .brand{ min-width:auto; }
      .controls{ justify-content:flex-start; margin-left:0; }
    }

    /* ====== SIDEBAR ====== */
    .sidebar{
      border:1px solid var(--stroke2);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:sticky;
      top:72px;
      align-self:start;
    }
    .side-inner{ padding:14px; }

    .author-card{
      border:1px solid var(--stroke2);
      border-radius: 16px;
      overflow:hidden;
      background: rgba(0,0,0,.20);
      position:relative;
    }
    .media-frame{
      width:100%;
      aspect-ratio: 4/5;
      background: rgba(0,0,0,.28);
      position:relative;
      display:grid;
      place-items:center;
      overflow:hidden;
    }
    .author-card img{
      width:100%;
      height:100%;
      object-fit: cover;
      object-position: center;
      display:block;
      cursor:pointer;
    }

    .overlay{
      position:absolute;
      left:10px; top:10px;
      display:flex; gap:6px; flex-wrap:wrap;
      pointer-events:none;
    }
    .badge{
      font-family:var(--ui);
      font-size:11px;
      padding:5px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.18);
      color:rgba(255,255,255,.88);
      font-weight:800;
      letter-spacing:.2px;
      backdrop-filter: blur(8px);
    }

    .heygen{
      width:100%; height:100%;
      display:none;
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.28);
    }
    .heygen iframe{
      width:100%; height:100%;
      border:0;
      display:block;
    }
    .media-actions{
      position:absolute;
      right:10px; top:10px;
      z-index:2;
      display:flex;
      gap:8px;
    }
    .mini-btn{
      font-family:var(--ui);
      font-weight:900;
      font-size:12px;
      padding:7px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(0,0,0,.45);
      color: rgba(255,255,255,.92);
      cursor:pointer;
      backdrop-filter: blur(8px);
      transition:.18s;
    }
    .mini-btn:hover{ transform: translateY(-1px); }

    .author-meta{
      padding:10px 12px 12px;
      font-family: var(--ui);
      color: var(--muted);
      font-size:12px;
      line-height:1.35;
    }
    .author-meta strong{
      display:block;
      color: var(--text);
      font-size:13px;
      margin-bottom:2px;
    }

    .side-title{
      margin:14px 2px 8px;
      font-family: var(--ui);
      font-weight:900;
      letter-spacing:.3px;
      color: rgba(255,255,255,.86);
      font-size:13px;
      text-transform: uppercase;
    }

    .index{
      display:flex;
      flex-direction:column;
      gap:6px;
      padding-bottom:4px;
    }
    .index a{
      text-decoration:none;
      color: rgba(255,255,255,.85);
      font-weight:800;
      font-size:13px;
      padding:9px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      transition:.18s;
    }
    .index a:hover{
      transform: translateY(-1px);
      background: rgba(240,195,106,.14);
      border-color: rgba(240,195,106,.28);
    }

    /* ====== BOOK/PAGES ====== */
    .book{
      border:1px solid var(--stroke2);
      border-radius: var(--radius);
      background: rgba(255,255,255,.06);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .book-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 12px;
      border-bottom:1px solid var(--stroke2);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(0,0,0,.10));
      font-family: var(--ui);
    }
    .book-top .hint{
      color: var(--muted2);
      font-size:12px;
      font-weight:700;
    }
    .book-top .hint b{ color:rgba(255,255,255,.85); }

    .pages{
      display:grid;
      grid-template-columns: 1fr;
      gap:0;
      padding:14px;
    }
    .two .pages{
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    @media (max-width: 980px){
      .two .pages{ grid-template-columns: 1fr; }
    }

    .page{
      background: var(--paper);
      color: var(--ink);
      border-radius: 16px;
      padding: 18px 18px 22px;
      border:1px solid var(--paperEdge);
      position:relative;
      overflow:hidden;
      box-shadow: 0 16px 35px rgba(0,0,0,.22);
      font-family: var(--font);
      line-height: 1.55;
    }
    .page:before{
      content:"";
      position:absolute;
      inset:0;
      background:
        linear-gradient(to bottom, transparent, rgba(0,0,0,.03)),
        repeating-linear-gradient(
          to bottom,
          transparent 0px,
          transparent 26px,
          var(--paperLine) 27px
        );
      pointer-events:none;
      opacity:.55;
    }
    .page-inner{ position:relative; z-index:1; }

    .page h1{
      font-size: 28px;
      margin: 2px 0 10px;
      line-height:1.15;
      letter-spacing:.2px;
    }
    .page h2{
      font-size: 18px;
      margin: 18px 0 8px;
      font-family: var(--ui);
      letter-spacing:.2px;
    }
    .page p{
      margin: 0 0 12px;
      font-size: 17px;
    }
    .page ul{
      margin: 6px 0 14px 18px;
      padding:0;
    }
    .page li{ margin: 6px 0; font-size: 16.5px; }

    .meta{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin: 10px 0 12px;
      font-family: var(--ui);
    }
    .meta span{
      font-size: 12px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid rgba(0,0,0,.12);
      background: rgba(0,0,0,.04);
      font-weight:800;
      color: rgba(0,0,0,.72);
    }

    figure.inline-media{
      margin: 12px 0 14px;
      border-radius: 16px;
      border:1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.45);
      overflow:hidden;
      box-shadow: 0 10px 22px rgba(0,0,0,.14);
    }
    figure.inline-media img.thumb{
      width:100%;
      display:block;
      cursor: zoom-in;
    }
    figure.inline-media figcaption{
      font-family: var(--ui);
      font-size: 12px;
      padding: 10px 12px;
      color: rgba(0,0,0,.70);
      border-top:1px solid rgba(0,0,0,.10);
    }

    .quote{
      border-left: 4px solid rgba(240,195,106,.85);
      padding: 10px 12px;
      margin: 14px 0;
      background: rgba(240,195,106,.18);
      border-radius: 12px;
      font-style: italic;
      font-size: 16.5px;
    }

    /* ====== IMAGE MODAL (zoom/pan/reset + resize) ====== */
    .img-pop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.75);
      display:none;
      z-index:80;
    }
    .img-pop.open{ display:block; }

    .img-pop .panel{
      position:absolute;
      left:50%;
      top:50%;
      transform: translate(-50%,-50%);
      width:min(920px, 92vw);
      height:min(640px, 80vh);
      background: rgba(15,20,26,.92);
      border:1px solid rgba(255,255,255,.18);
      border-radius: 18px;
      box-shadow: 0 22px 60px rgba(0,0,0,.60);
      overflow:hidden;
    }
    .pop-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.14);
      font-family: var(--ui);
      color: rgba(255,255,255,.88);
      font-weight:900;
    }
    .pop-top .title{
      font-size:12px;
      letter-spacing:.2px;
      opacity:.95;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 55%;
    }
    .pop-actions{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;
    }
    .pop-actions button{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.92);
      padding:7px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:900;
      font-size:12px;
    }
    .pop-actions button:hover{ background: rgba(255,255,255,.12); }
    .pop-body{
      width:100%;
      height: calc(100% - 52px);
      position:relative;
      overflow:hidden;
      touch-action:none;
    }
    .pop-body img{
      position:absolute;
      left:50%;
      top:50%;
      transform: translate(-50%,-50%) scale(1);
      transform-origin: center center;
      user-select:none;
      -webkit-user-drag:none;
      max-width:none;
      max-height:none;
      cursor: grab;
    }
    .pop-body img:active{ cursor: grabbing; }

    .resize-handle{
      position:absolute;
      width:18px; height:18px;
      right:8px; bottom:8px;
      border-radius: 6px;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.10);
      cursor: nwse-resize;
    }

    /* ====== NOTES WINDOW (draggable, autosave, export, per-file key) ====== */
    .notes{
      position:fixed;
      right: 18px;
      bottom: 18px;
      width:min(360px, calc(100vw - 28px));
      height: 320px;
      background: rgba(15,20,26,.92);
      border:1px solid rgba(255,255,255,.18);
      border-radius: 18px;
      box-shadow: 0 20px 55px rgba(0,0,0,.55);
      z-index:60;
      display:none;
      overflow:hidden;
    }
    .notes.open{ display:block; }

    .notes .bar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 10px;
      background: rgba(255,255,255,.06);
      border-bottom:1px solid rgba(255,255,255,.14);
      font-family: var(--ui);
      color: rgba(255,255,255,.88);
      font-weight:900;
      cursor:grab;
      user-select:none;
    }
    .notes .bar:active{ cursor:grabbing; }
    .notes .bar .left{
      display:flex; gap:8px; align-items:center;
      font-size:12px;
      letter-spacing:.2px;
    }
    .notes .bar .dot{
      width:10px; height:10px; border-radius:99px;
      background: rgba(240,195,106,.95);
      box-shadow: 0 0 0 2px rgba(240,195,106,.20);
    }
    .notes .bar .right{
      display:flex; gap:6px; flex-wrap:wrap; justify-content:flex-end;
    }
    .notes .bar button{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.92);
      padding:6px 9px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:900;
      font-size:12px;
    }
    .notes .bar button:hover{ background: rgba(255,255,255,.12); }

    .notes textarea{
      width:100%;
      height: calc(100% - 52px);
      border:0;
      outline:none;
      resize:none;
      background: transparent;
      color: rgba(255,255,255,.92);
      padding: 12px 12px 10px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 13px;
      line-height: 1.45;
    }

    .notes .status{
      position:absolute;
      left:12px;
      bottom:8px;
      font-family: var(--ui);
      font-size:11px;
      color: rgba(255,255,255,.70);
      pointer-events:none;
    }
    .notes .count{
      position:absolute;
      right:12px;
      bottom:8px;
      font-family: var(--ui);
      font-size:11px;
      color: rgba(255,255,255,.70);
      pointer-events:none;
    }
  </style>
</head>
<body>

  <header>
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h2>Pirandello ‚Äî Percorso</h2>
          <small>Layout quaderno ‚Ä¢ immagini cliccabili ‚Ä¢ appunti salvati</small>
        </div>
      </div>

      <div class="controls">
        <div class="seg" role="tablist" aria-label="Modalit√† pagine">
          <button id="onePageBtn" class="active" type="button" aria-selected="true">1 pagina</button>
          <button id="twoPageBtn" type="button" aria-selected="false">2 pagine</button>
        </div>

        <div class="slider" title="Dimensione testo">
          Aa <input id="fontSize" type="range" min="16" max="24" value="18" /> A+
        </div>

        <button class="btn" id="toggleNotes" aria-pressed="false">üìù Appunti</button>
      </div>
    </div>
  </header>

  <div class="wrap">
    <!-- SINISTRA -->
    <aside class="sidebar">
      <div class="side-inner">

        <div class="author-card" aria-label="Autore e video">
          <div class="media-frame" id="mediaFrame">
            <img id="authorImg" src="assets/Pirandello-Moscarda.PNG" alt="Pirandello e Moscarda (clicca per video)" />

            <div class="overlay">
              <span class="badge">clic sulla foto ‚Üí video</span>
              <span class="badge" id="mediaState">foto</span>
            </div>

            <div class="heygen" id="heygenWrap" aria-hidden="true">
              <div class="media-actions">
                <button class="mini-btn" id="backToImg" type="button">Torna alla foto</button>
              </div>

              <iframe
                id="heygenIframe"
                width="560"
                height="315"
                src="https://www.youtube.com/embed/98AOicZe5aI?si=WIzIz_yJ-iyX0d0i&autoplay=1&mute=1&playsinline=1&rel=0"
                title="YouTube video player"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                referrerpolicy="strict-origin-when-cross-origin"
                allowfullscreen>
              </iframe>
            </div>
          </div>

          <div class="author-meta">
            <strong>Pirandello ‚Äî Vitangelo Moscarda</strong>
            <span>clic sulla foto ‚Üí video</span>
          </div>
        </div>

        <!-- INDICE -->
        <div class="side-title">Indice</div>
        <nav class="index" aria-label="Indice">
          <a href="Pirandello.html">L‚Äôimmagine del mondo</a>

          <a href="Umorismo.html">Umorismo</a>
          <a href="Novelle.html">Novelle</a>

          <a href="Romanzi.html">I romanzi</a>
          <a href="Mattia.html" style="padding-left:22px;">- Il fu Mattia Pascal</a>
          <a href="Uno.html" style="padding-left:22px; font-weight:800; text-decoration:underline;">- Uno, nessuno e centomila</a>

          <a href="Teatro.html">Il teatro</a>
          <a href="Cosi.html" style="padding-left:22px;">- Cos√¨ √® (se vi pare)</a>
          <a href="Sei.html" style="padding-left:22px;">- Sei personaggi in cerca d‚Äôautore</a>

          <a href="Conclusione.html">Conclusione</a>
        </nav>

      </div>
    </aside>

    <!-- DESTRA -->
    <section class="book" id="book">
      <div class="book-top">
        <div class="hint">
          <b>Uno, nessuno e centomila</b> ‚Ä¢ testo selezionabile ‚Ä¢ immagini nel flusso (clic ‚Üí zoom)
        </div>
        <div class="hint">Suggerimento: usa ‚Äú2 pagine‚Äù su desktop, ‚Äú1 pagina‚Äù su mobile.</div>
      </div>

      <div class="pages" id="pages">

        <!-- PAGINA 1 -->
        <article class="page" id="page1">
          <div class="page-inner">

            <div class="meta">
              <span>Ultimo romanzo (1926)</span>
              <span>Frantumazione della personalit√†</span>
              <span>Filosofia e delirio</span>
              <span>Epifania: il ‚Äúnaso storto‚Äù</span>
            </div>

            <h1>Contesto</h1>
            <p>Uno, nessuno e centomila √® l‚Äôultimo romanzo di Pirandello, pubblicato nel 1926, dapprima a puntate sulla ‚ÄúFiera Letteraria‚Äù e poi in volume. Rappresenta il punto pi√π estremo della sua concezione della frantumazione della personalit√†, ma si distingue dagli altri romanzi per la scarsit√† di fatti narrati e per l‚Äôampio spazio dato alle riflessioni del protagonista, sospese tra filosofia e delirio.</p>

            <h1>Trama</h1>
            <p>Il protagonista, Vitangelo Moscarda, entra in crisi a partire da un dettaglio apparentemente insignificante: un giorno la moglie gli fa notare che il suo naso pende leggermente verso destra, cosa di cui non si era mai accorto. Da questa osservazione nasce un dubbio radicale: ciascuno ha di s√© un‚Äôimmagine che non coincide con le innumerevoli immagini che gli altri costruiscono su di lui.</p><p>Moscarda decide allora di mettere alla prova la propria identit√† attraverso comportamenti che appaiono inspiegabili agli occhi del senso comune. Sfratta due anziani inquilini, attirandosi il disprezzo della gente, ma subito dopo dona loro la casa con atto notarile, suscitando la rabbia dei parenti e dei soci. In seguito chiude la banca ereditata dal padre, ritenendo l‚Äôattivit√† bancaria una forma di usura: la decisione provoca la reazione dei familiari e dei soci, che tentano di farlo interdire.</p><p>Convinto dal vescovo, Moscarda devolve tutti i suoi beni in opere di carit√†. Rimasto solo, si ritira in un ospizio costruito con il proprio denaro e porta a compimento la sua autoemarginazione: senza legami col passato e senza progetti per il futuro, rinuncia persino a pensare, lasciandosi consumare dal tempo.</p>

            <figure class="inline-media">
              <img class="thumb" src="assets/Uno-nessuno-centomila.png" alt="Schema riassuntivo: Uno, nessuno e centomila" data-title="Schema: contesto, trama, esito" />
              <figcaption>Schema sintetico: contesto, snodo conoscitivo, ‚Äúuno/nessuno/centomila‚Äù, esito.</figcaption>
            </figure>

          </div>
        </article>

        <!-- PAGINA 2 -->
        <article class="page" id="page2">
          <div class="page-inner">
            <h1>Lettura secondo l‚Äôimmagine del mondo e la poetica</h1>

            <div class="meta">
              <span>Realt√† senza centro</span>
              <span>Io frantumato</span>
              <span>Maschere sociali</span>
              <span>Dissoluzione delle forme</span>
            </div>

            <figure class="inline-media">
              <img class="thumb" src="assets/Uno-nessuno-centomila2.png" alt="Lettura secondo l‚Äôimmagine del mondo e la poetica" data-title="Immagine del mondo e poetica" />
              <figcaption>Quadro interpretativo: identit√† come riflesso, umorismo come smascheramento, oltre le forme.</figcaption>
            </figure>

            <p>In Uno, nessuno e centomila Pirandello porta alle estreme conseguenze la propria immagine del mondo: la realt√† non possiede un centro stabile e l‚Äôio non √® mai una sostanza, ma un punto mobile, continuamente deformato dallo sguardo altrui. Se ne Il fu Mattia Pascal l‚Äôidentit√† si incrinava attraverso il caso, qui essa si dissolve per via di un atto di conoscenza: il protagonista prende coscienza della propria molteplicit√†.</p><p>La scoperta del naso ‚Äústorto‚Äù non √® un semplice dettaglio realistico, ma l‚Äôinnesco filosofico del romanzo: Moscarda comprende che l‚Äôimmagine che ciascuno ha di s√© non coincide con nessuna di quelle che vivono negli altri. L‚Äôio non √® uno, ma una somma infinita di riflessi incompatibili. Da questo momento l‚Äôesistenza non √® pi√π abitabile, perch√© ogni forma identitaria appare come una falsificazione.</p><p>La poetica dell‚Äôumorismo qui perde ogni residuo comico per trasformarsi in un processo radicale di smascheramento. Le azioni paradossali di Moscarda non mirano a scandalizzare, ma a distruggere le maschere sociali una a una. Ogni gesto che dovrebbe liberarlo genera invece nuove immagini, nuove definizioni, nuove prigioni. La forma, per Pirandello, √® inevitabile: appena l‚Äôuomo agisce, viene fissato.</p><p>L‚Äôimmagine del mondo √® ormai spogliata di ogni illusione: la societ√† esiste solo come sistema di ruoli, e l‚Äôidentit√† √® un dispositivo di controllo, non una verit√† interiore. A differenza di Mattia Pascal, Moscarda non tenta di sostituire una forma con un‚Äôaltra, ma sceglie di negarle tutte. √à una scelta estrema, che non conduce alla libert√†, bens√¨ alla dissoluzione.</p><p>Il finale segna il punto limite della ricerca pirandelliana: rinunciando al nome, alla memoria, al progetto e perfino al pensiero, Moscarda tenta di coincidere con il puro fluire della vita. Ma questa ‚Äúliberazione‚Äù ha il prezzo dell‚Äôannullamento dell‚Äôio. Pirandello non propone un modello da seguire: mostra, con lucidit√† spietata, che oltre le forme non c‚Äô√® una verit√† pi√π alta, ma il silenzio. L‚Äôuomo pu√≤ essere uno, centomila o nessuno; non pu√≤ essere intero, se non nell‚Äôunico luogo dove questa frammentazione pu√≤ essere accettata: il manicomio.</p>

          </div>
        </article>

      </div>
    </section>
  </div>

  <!-- IMAGE POPUP -->
  <div class="img-pop" id="imgPop" aria-hidden="true">
    <div class="panel" id="popPanel" role="dialog" aria-modal="true" aria-label="Immagine ingrandita">
      <div class="pop-top">
        <div class="title" id="popTitle">Immagine</div>
        <div class="pop-actions">
          <button type="button" id="zoomIn">Zoom +</button>
          <button type="button" id="zoomOut">Zoom ‚àí</button>
          <button type="button" id="resetPop">Reset</button>
          <button type="button" id="closePop">Chiudi</button>
        </div>
      </div>
      <div class="pop-body" id="popBody">
        <img id="popImg" alt="Immagine" />
        <div class="resize-handle" id="popResize" title="Ridimensiona finestra"></div>
      </div>
    </div>
  </div>

  <!-- NOTES -->
  <div class="notes" id="notesWin" aria-hidden="true">
    <div class="bar" id="notesDrag" title="Trascina la finestra">
      <div class="left">
        <span class="dot" aria-hidden="true"></span>
        <span>Appunti</span>
      </div>
      <div class="right">
        <button type="button" id="exportTxt">Export .txt</button>
        <button type="button" id="clearNotes">Pulisci</button>
        <button type="button" id="closeNotes">Chiudi</button>
      </div>
    </div>
    <textarea id="notesText" placeholder="Scrivi qui‚Ä¶ (autosave)"></textarea>
    <div class="status" id="status">Salvato</div>
    <div class="count" id="counter">0 caratteri</div>
  </div>

  <script>
    // ====== INDICE ======
    document.querySelectorAll('.index a').forEach(a=>{
      a.addEventListener('click',(e)=>{
        const href=a.getAttribute('href');
        if(!href || !href.startsWith('#')) return;
        const target=document.querySelector(href);
        if(!target) return;
        e.preventDefault();
        target.scrollIntoView({behavior:'smooth', block:'start'});
      });
    });

    // ====== 2 PAGINE ======
    const onePageBtn=document.getElementById('onePageBtn');
    const twoPageBtn=document.getElementById('twoPageBtn');
    function setMode(two){
      document.getElementById('book').classList.toggle('two', two);
      onePageBtn.classList.toggle('active', !two);
      twoPageBtn.classList.toggle('active', two);
      onePageBtn.setAttribute('aria-selected', (!two).toString());
      twoPageBtn.setAttribute('aria-selected', (two).toString());
    }
    onePageBtn.addEventListener('click',()=>setMode(false));
    twoPageBtn.addEventListener('click',()=>setMode(true));

    // ====== FONT SIZE ======
    const fontSize=document.getElementById('fontSize');
    function applyFont(){
      const size=fontSize.value;
      document.querySelectorAll('.page p, .page li').forEach(el=>el.style.fontSize = size+'px');
      document.querySelectorAll('.page h1').forEach(el=>el.style.fontSize = (parseInt(size)+10)+'px');
    }
    fontSize.addEventListener('input', applyFont);
    applyFont();

    // ====== IMAGE POPUP (zoom/pan/reset + resize) ======
    const imgPop=document.getElementById('imgPop');
    const popImg=document.getElementById('popImg');
    const popTitle=document.getElementById('popTitle');
    const closePop=document.getElementById('closePop');
    const zoomIn=document.getElementById('zoomIn');
    const zoomOut=document.getElementById('zoomOut');
    const resetPop=document.getElementById('resetPop');
    const popBody=document.getElementById('popBody');
    const popPanel=document.getElementById('popPanel');
    const popResize=document.getElementById('popResize');

    let pscale=1, ptx=0, pty=0;
    let pdrag={active:false, x:0, y:0};

    const clamp=(n,min,max)=>Math.max(min, Math.min(max,n));
    const applyPopTransform=()=> {
      popImg.style.transform = `translate(calc(-50% + ${ptx}px), calc(-50% + ${pty}px)) scale(${pscale})`;
    };

    function openImagePop(src,title){
      popImg.src=src;
      popTitle.textContent=title || 'Immagine';
      pscale=1; ptx=0; pty=0; applyPopTransform();

      imgPop.classList.add('open');
      imgPop.setAttribute('aria-hidden','false');
      document.body.style.overflow='hidden';
    }
    function closeImagePop(){
      imgPop.classList.remove('open');
      imgPop.setAttribute('aria-hidden','true');
      document.body.style.overflow='';
      popImg.src='';
    }

    document.querySelectorAll('img.thumb').forEach(img=>{
      img.addEventListener('click', ()=>{
        openImagePop(img.getAttribute('src'), img.dataset.title || img.alt);
      });
    });

    closePop.addEventListener('click', closeImagePop);
    imgPop.addEventListener('click', (e)=>{ if(e.target===imgPop) closeImagePop(); });

    zoomIn.addEventListener('click', ()=>{ pscale=clamp(pscale*1.15, .6, 6); applyPopTransform(); });
    zoomOut.addEventListener('click', ()=>{ pscale=clamp(pscale/1.15, .6, 6); applyPopTransform(); });
    resetPop.addEventListener('click', ()=>{ pscale=1; ptx=0; pty=0; applyPopTransform(); });

    popBody.addEventListener('wheel', (e)=>{
      e.preventDefault();
      const delta = Math.sign(e.deltaY);
      if(delta>0) pscale = clamp(pscale/1.12, .6, 6);
      else pscale = clamp(pscale*1.12, .6, 6);
      applyPopTransform();
    }, {passive:false});

    popBody.addEventListener('pointerdown',(e)=>{
      if(e.target===popResize) return;
      pdrag.active=true;
      pdrag.x=e.clientX;
      pdrag.y=e.clientY;
      popBody.setPointerCapture(e.pointerId);
    });
    popBody.addEventListener('pointermove',(e)=>{
      if(!pdrag.active) return;
      const dx=e.clientX-pdrag.x, dy=e.clientY-pdrag.y;
      pdrag.x=e.clientX; pdrag.y=e.clientY;
      ptx += dx; pty += dy;
      applyPopTransform();
    });
    popBody.addEventListener('pointerup',()=>pdrag.active=false);
    popBody.addEventListener('pointercancel',()=>pdrag.active=false);

    // Resize panel
    let presize={active:false, startX:0, startY:0, startW:0, startH:0};
    popResize.addEventListener('pointerdown',(e)=>{
      presize.active=true;
      presize.startX=e.clientX; presize.startY=e.clientY;
      const r=popPanel.getBoundingClientRect();
      presize.startW=r.width; presize.startH=r.height;
      popResize.setPointerCapture(e.pointerId);
    });
    popResize.addEventListener('pointermove',(e)=>{
      if(!presize.active) return;
      const dx=e.clientX-presize.startX, dy=e.clientY-presize.startY;
      popPanel.style.width  = clamp(presize.startW+dx, 320, window.innerWidth-16) + 'px';
      popPanel.style.height = clamp(presize.startH+dy, 240, window.innerHeight-16) + 'px';
    });
    popResize.addEventListener('pointerup',()=>presize.active=false);
    popResize.addEventListener('pointercancel',()=>presize.active=false);

    // ====== FOTO ‚Üí VIDEO (solo nella sidebar) ======
    const authorImg = document.getElementById('authorImg');
    const heygenWrap = document.getElementById('heygenWrap');
    const heygenIframe = document.getElementById('heygenIframe');
    const backToImg = document.getElementById('backToImg');
    const mediaState = document.getElementById('mediaState');

    const REAL_SRC = heygenIframe.getAttribute('src');
    heygenIframe.dataset.src = REAL_SRC;
    heygenIframe.src = "about:blank";

    function showVideo(){
      heygenIframe.src = heygenIframe.dataset.src;
      heygenWrap.style.display = "block";
      heygenWrap.setAttribute("aria-hidden","false");
      authorImg.style.visibility = "hidden";
      mediaState.textContent = "video";
    }
    function showImage(){
      heygenIframe.src = "about:blank";
      heygenWrap.style.display = "none";
      heygenWrap.setAttribute("aria-hidden","true");
      authorImg.style.visibility = "visible";
      mediaState.textContent = "foto";
    }

    authorImg.addEventListener('click', showVideo);
    backToImg.addEventListener('click', showImage);

    // ====== APPUNTI ======
    const toggleNotes=document.getElementById('toggleNotes');
    const notesWin=document.getElementById('notesWin');
    const notesDrag=document.getElementById('notesDrag');
    const notesText=document.getElementById('notesText');
    const closeNotes=document.getElementById('closeNotes');
    const exportTxt=document.getElementById('exportTxt');
    const clearNotes=document.getElementById('clearNotes');
    const statusEl=document.getElementById('status');
    const counter=document.getElementById('counter');

    const NOTES_KEY = `mw_notes::${location.pathname}`;
    const POS_KEY = `mw_notes_pos::${location.pathname}`;

    function openNotes(){ notesWin.classList.add('open'); toggleNotes.setAttribute('aria-pressed','true'); notesText.focus(); }
    function closeNotesWin(){ notesWin.classList.remove('open'); toggleNotes.setAttribute('aria-pressed','false'); }

    toggleNotes.addEventListener('click', ()=> notesWin.classList.contains('open') ? closeNotesWin() : openNotes());
    closeNotes.addEventListener('click', closeNotesWin);

    const saved=localStorage.getItem(NOTES_KEY);
    if(saved!==null) notesText.value=saved;

    function updateCounter(){ counter.textContent = `${notesText.value.length} caratteri`; }
    updateCounter();

    let saveTimer=null;
    notesText.addEventListener('input', ()=>{
      updateCounter();
      statusEl.textContent='Scrivendo‚Ä¶';
      clearTimeout(saveTimer);
      saveTimer=setTimeout(()=>{
        localStorage.setItem(NOTES_KEY, notesText.value);
        statusEl.textContent='Salvato';
      }, 350);
    });

    exportTxt.addEventListener('click', ()=>{
      const blob=new Blob([notesText.value], {type:'text/plain;charset=utf-8'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      const base=(location.pathname.split('/').pop()||'appunti').replace('.html','');
      a.download = `${base}-appunti.txt`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=>URL.revokeObjectURL(a.href), 500);
    });

    clearNotes.addEventListener('click', ()=>{
      if(!confirm('Vuoi cancellare gli appunti di questa lezione?')) return;
      notesText.value='';
      localStorage.removeItem(NOTES_KEY);
      updateCounter();
      statusEl.textContent='Cancellato';
    });

    // Drag + save position
    let ndrag={active:false, startX:0, startY:0, startLeft:0, startTop:0};
    const posSaved=localStorage.getItem(POS_KEY);
    if(posSaved){
      try{
        const p=JSON.parse(posSaved);
        notesWin.style.left = p.left+'px';
        notesWin.style.top  = p.top+'px';
        notesWin.style.right='auto';
        notesWin.style.bottom='auto';
      }catch(e){}
    }

    notesDrag.addEventListener('pointerdown',(e)=>{
      ndrag.active=true;
      const r=notesWin.getBoundingClientRect();
      ndrag.startX=e.clientX; ndrag.startY=e.clientY;
      ndrag.startLeft=r.left; ndrag.startTop=r.top;
      notesDrag.setPointerCapture(e.pointerId);
      notesWin.style.left=r.left+'px';
      notesWin.style.top=r.top+'px';
      notesWin.style.right='auto'; notesWin.style.bottom='auto';
    });
    notesDrag.addEventListener('pointermove',(e)=>{
      if(!ndrag.active) return;
      const dx=e.clientX-ndrag.startX, dy=e.clientY-ndrag.startY;
      const r=notesWin.getBoundingClientRect(), w=r.width, h=r.height;
      notesWin.style.left = clamp(ndrag.startLeft+dx, 8, window.innerWidth-w-8) + 'px';
      notesWin.style.top  = clamp(ndrag.startTop +dy, 8, window.innerHeight-h-8) + 'px';
    });
    notesDrag.addEventListener('pointerup', ()=>{
      if(!ndrag.active) return;
      ndrag.active=false;
      const r=notesWin.getBoundingClientRect();
      localStorage.setItem(POS_KEY, JSON.stringify({left: Math.round(r.left), top: Math.round(r.top)}));
    });
    notesDrag.addEventListener('pointercancel', ()=>ndrag.active=false);

    // Close popup with ESC
    window.addEventListener('keydown',(e)=>{
      if(e.key==='Escape'){
        if(imgPop.classList.contains('open')) closeImagePop();
        if(notesWin.classList.contains('open')) closeNotesWin();
        showImage();
      }
    });
  </script>
</body>
</html>
